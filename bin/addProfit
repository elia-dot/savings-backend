#! /app/.heroku/node/bin/node
const Child = require('../models/Child');
const Saving = require('../models/Saving');
const date = new Date();

if (date.getDate() === 24) {
  try {
    console.log('addindg profit');
    let childs;
    const getChilds = async () => {
      childs = await Child.find({ revenue: { $gt: 0 } });
    };
    getChilds();
    childs.forEach((child) => {
      const total = child.saving + child.profit;
      const profit = total * (child.revenue / 100);
      child.profit += profit;
      child.save();

      const createSaving = async () => {
        await Saving.create({
          user: child._id,
          amount: profit,
          description: 'monthly profit',
        });
      };
      createSaving();
    });
    console.log('profit added');
  } catch (error) {
    console.log(error);
  }
} else {
  console.log('Not today');
}
